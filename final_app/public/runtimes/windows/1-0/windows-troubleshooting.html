<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <!-- Always force latest IE rendering engine or request Chrome Frame -->
  <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">

  
  <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,300italic,400italic,400,600' rel='stylesheet' type='text/css'>
  <!-- Use title if it's in the page YAML frontmatter -->
  <title>
      Troubleshooting Windows Cells |
    Pivotal Docs
  </title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="/stylesheets/all.css" rel="stylesheet" media="screen, print" />
  <link href="/stylesheets/print.css" rel="stylesheet" media="print" />
  <link href='/images/favicon.ico' rel='shortcut icon'>

  <script src="/javascripts/all.js"></script>
  
<script type="text/javascript">
  if (window.location.host === 'docs.pivotal.io') {
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', '']);
    _gaq.push(['_setDomainName', '']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script');
      ga.type = 'text/javascript';
      ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(ga, s);
    })();
  }
</script>

<script type="text/javascript">
  var blackList = ['acceptance'];

  blackList.forEach(function(blackListedEnv) {
    if (document.URL.indexOf(blackListedEnv) > -1 && blackListedEnv != "") {
      $('head').append('<meta name="hashtag" content="PivotalMoment">');
    }
  });
</script>

<!-- CrazyEgg Tracking Script -->
  <script type="text/javascript">
  setTimeout(function(){var a=document.createElement("script");
  var b=document.getElementsByTagName("script")[0];
  a.src=document.location.protocol+"//script.crazyegg.com/pages/scripts/0055/2990.js?"+Math.floor(new Date().getTime()/3600000);
  a.async=true;a.type="text/javascript";b.parentNode.insertBefore(a,b)}, 1);
  </script>

<!-- Munchkin Marketo Script -->
<script type="text/javascript">
  (function() {
    var didInit = false;

    function initMunchkin() {
      if (didInit === false) {
        didInit = true;
        Munchkin.init('625-IUJ-009');
      }
    }

    var s = document.createElement('script');
    s.type = 'text/javascript';
    s.async = true;
    s.src = document.location.protocol + '//munchkin.marketo.net/munchkin.js';
    s.onreadystatechange = function() {
      if (this.readyState == 'complete' || this.readyState == 'loaded') {
        initMunchkin();
      }
    };
    s.onload = initMunchkin;
    document.getElementsByTagName('head')[0].appendChild(s);
  })();
</script>

</head>

<body class="runtimes runtimes_windows runtimes_windows_1-0 runtimes_windows_1-0_windows-troubleshooting has-subnav">

<div class="viewport">
  <div class='wrap'>
    <script type="text/javascript">
      document.domain = "";
    </script>

      <header class="global-header header header-layout js-bar-links">
    <a class="pivotal-logo" href="/">
    </a>
    <a href="/" class="global-header-title">
      <span class="title-deemph">Pivotal</span> Documentation
    </a>
    <div class="btn-menu" data-behavior="MenuMobile"></div>
    <div class="header-links">
      <div class="header-item">
        <a href=""></a>
      </div>
      <div class="header-item">
        <a href="http://support.pivotal.io" target="_blank">Support</a>
      </div>

      <div class="header-item embedded-searchbar">
          <form method="get" action="/search">
            <input name="q" placeholder="Search PAS for Windows v1.0" class="search-box" />
              <input type="hidden" name="product_name" value="PAS for Windows" />
              <input type="hidden" name="product_version" value="1.0"/>
          </form>
      </div>
      
    </div>
  </header>



    <div class="container">

      <!--googleoff: index-->
      <div id="sub-nav" class="js-sidenav nav-container" role="navigation">
  <a class="sidenav-title" data-behavior="SubMenuMobile">
    Doc Index
  </a>
  <div class="nav-content">
    <ul>

      <li class="has_submenu">
        <a href="/runtimes/windows/1-0/index.html">PAS for Windows</a>
      </li>        
    </ul>
  </div>
</div><!--end of sub-nav-->
      <!--googleon: index-->

      <main class="content content-layout" id="js-content" role="main">
        <a id="top"></a>
          <div class="local-header title-container">
    <div class="local-header version-info">
      LATEST VERSION: v1.0 - <a href="">CHANGELOG</a>
    </div>
    <div class="local-header local-title clearfix">
      <img src="/images/cloud_rings.png">
      <span class="local-header-title">PAS for Windows
      </span>
      <span class="local-header local-version header-dropdown">
        <a class="local-header header-dropdown-link">v1.0</a>
        <span class="local-header header-dropdown-content">
          <ul>
                <li>
                    <a href="https://docs.pivotal.io/runtimes/windows/0-8/windows-troubleshooting.html">v0.8</a>
                </li>
          </ul>
        </span>
      </span>

      <!-- search was here -->
    </div>
    <div class="local-header local-header-links">
    </div>
  </div>

          <h1 class="title-container" >
    Troubleshooting Windows Cells
  </h1>

          <div id="js-quick-links" >
            <div class="quick-links"><ul>
<li><a href="#log-types">Windows Cell Log Types</a></li>
<li>
<a href="#logs">Access Windows Event Logs</a><ul>
<li><a href="#syslog">Send Cell Logs to a Syslog Server</a></li>
<li><a href="#download">Download Cell Logs</a></li>
</ul>
</li>
<li>
<a href="#rdp">Connect to a Windows Cell</a><ul><li><a href="#consul">Consul CLI</a></li></ul>
</li>
</ul></div>
          </div>
        <div class="to-top" id="js-to-top">
          <a href="#top" title="back to top"></a>
        </div>
        <p><strong></strong></p>

<p>This topic describes how to troubleshoot Windows cells deployed by Pivotal Application Service (PAS) for Windows 2012R2.</p>

<h2 id="-windows-cell-log-types"><a id='log-types'></a> Windows Cell Log Types</h2>

<p>Windows cells generate two types of logs:</p>

<ul>
<li><p><strong>BOSH job logs</strong>, such as <code>rep_windows</code> and <code>consul_agent_windows</code>. These logs stream to the syslog server configured in the PAS tile <strong>System Logging</strong> pane, along with other PCF component logs. The names of these BOSH job logs correspond to the names of the logs emitted by Linux Diego cells.</p></li>
<li><p><strong>Windows Event logs</strong>. These stream to the syslog server configured in the PAS for Windows 2012R2 <strong>System Logging</strong> pane and are downloadable through Ops Manager, as described <a href="#logs">below</a>.</p></li>
</ul>

<h2 id="-access-windows-event-logs"><a id='logs'></a> Access Windows Event Logs</h2>

<p>PCF operators can access log messages from Windows Diego cells in two ways:</p>

<ul>
<li><p>Configure PAS for Windows to <a href="#syslog">send</a> all Windows cell logs to an external syslog server.</p></li>
<li><p><a href="#download">Download</a> archived logs from each Windows cell individually.</p></li>
</ul>

<h3 id="-send-cell-logs-to-a-syslog-server"><a id='syslog'></a> Send Cell Logs to a Syslog Server</h3>

<p>To forward Windows cell log messages to an external syslog server, complete the following steps:</p>

<ol>
<li><p>Navigate to the Ops Manager Installation Dashboard.</p></li>
<li><p>Click the <strong>PAS for Windows 2012R2</strong> tile.</p></li>
<li><p>Under the <strong>Settings</strong> tab, select the <strong>System Logging</strong> pane.
<img src="images/win-syslog-config.png" alt="Win syslog config" /></p></li>
<li><p>Under <strong>Enable Syslog for VM logs?</strong>, click <strong>Enable</strong></p></li>
<li><p>Under <strong>Address</strong>, enter the IP address of your syslog server.</p></li>
<li><p>Under <strong>Port</strong>, enter the port of your syslog server. The typical port for a syslog server is <code>514</code>.
<p class="note"><strong>Note</strong>: The host must be reachable from the PAS network. Ensure your syslog server listens on external interfaces.</p></p></li>
<li><p>Under <strong>Protocol</strong>, select the transport protocol to use when forwarding logs.</p></li>
<li><p>Click <strong>Save</strong>.</p></li>
</ol>

<h3 id="-download-cell-logs"><a id='download'></a> Download Cell Logs</h3>

<p>Perform the following steps to retrieve the logs for the Windows cell:</p>

<ol>
<li>Navigate to the Ops Manager Installation Dashboard.</li>
<li>Click the <strong>PAS for Windows 2012R2</strong> tile.</li>
<li>Click the <strong>Status</strong> tab.</li>
<li>Under the <strong>Logs</strong> column, click the download icon for the Windows cell you want to retrieve logs from.</li>
<li>Click the <strong>Logs</strong> tab.</li>
<li>When the logs are ready, click the filename to download them.</li>
<li>Unzip the file to examine the contents. Each component on the cell has its own logs directory:

<ul>
<li><code>/consul_agent_windows/</code></li>
<li><code>/garden-windows/</code></li>
<li><code>/metron_agent_windows/</code></li>
<li><code>/rep_windows/</code></li>
</ul></li>
</ol>

<h2 id="-connect-to-a-windows-cell"><a id='rdp'></a> Connect to a Windows Cell</h2>

<p>Perform the following steps to connect to your Windows cell to run diagnostics:</p>

<ol>
<li><p>Download and install a Remote Desktop Protocol (RDP) client.</p>

<ul>
<li>For Mac OS X, download the Microsoft Remote Desktop app from the <a href="https://itunes.apple.com/us/app/microsoft-remote-desktop/id715768417?mt=12">Mac App Store</a>.</li>
<li>For Windows, download the Microsoft Remote Desktop app from <a href="https://www.microsoft.com/en-us/store/p/microsoft-remote-desktop/9wzdncrfj3ps">Microsoft</a>.</li>
<li>For Linux/UNIX, download an RDP client like <a href="http://www.rdesktop.org/">rdesktop</a>.</li>
</ul></li>
<li><p>Select the <strong>Enable Remote Desktop Protocol</strong> checkbox under <code>VM Options</code> in the tile.
<img src="images/vm-options.png" alt="Vm options" /></p></li>
<li><p>Obtain the IP address of the Windows cell you would like to connect to from the <code>Status</code> tab of the tile.</p></li>
</ol>

<h4 id="obtain-login-credentials-for-your-windows-cell.">Obtain login credentials for your Windows cell.</h4>

<ul>
<li>AWS or vSphere: if you chose <strong>Set the password</strong> under <strong>VM Options</strong> &gt; <strong>Manage Administrator Password</strong> when you configured the PCF Runtime for Windows tile, the username is <code>Administrator</code> and the password is the one you entered. If you did not set the password, it is not possible to obtain the current Administrator password through the IaaS, because the BOSH agent randomized the password.</li>
<li>GCP: follow the <a href="https://cloud.google.com/compute/docs/instances/windows/connecting-to-windows-instance">linked instructions</a> for obtaining credentials.</li>
<li>Azure: follow the <a href="https://docs.microsoft.com/en-us/azure/virtual-machines/windows/connect-logon">linked instructions</a> for obtaining credentials.</li>
</ul>

<h4 id="establish-an-rdp-connection">Establish an RDP connection</h4>

<ul>
<li><p>Open your RDP client. The examples below use the Microsoft Remote Desktop app.</p></li>
<li><p>Click <strong>New</strong> and enter your connection information:
<img src="images/rdp-connect.png" alt="Rdp connect" /></p>

<ul>
<li><strong>Connection name</strong>: Enter a name for this connection.</li>
<li><strong>PC name</strong>: Enter the IP address of your Windows cell.</li>
<li><strong>User name</strong>: Enter the appropriate username.</li>
<li><strong>Password</strong>: Enter the password of your Windows cell that you created.</li>
</ul></li>
</ul>

<ol>
<li><p>To mount a directory on your local machine as a drive in the Windows cell, perform the following steps:</p>

<ol>
<li>From the same <strong>Edit Remote Desktops</strong> window as above, click <strong>Redirection</strong>.</li>
<li>Click the plus icon at the bottom left.
<img src="images/rdp-redirection.png" alt="Rdp redirection" /></li>
<li>For <strong>Name</strong>, enter the name of the drive as it will appear in the Windows cell. For <strong>Path</strong>, enter the path of the local directory.</li>
<li>Click <strong>OK</strong>.</li>
</ol></li>
<li><p>Close the <strong>Edit Remote Desktops</strong> window and double-click the newly added connection under <strong>My Desktops</strong> to open a RDP connection to the Windows cell.</p></li>
<li><p>In the RDP session, you can use the <a href="#consul">Consul CLI</a> to diagnose problems with your Windows cell.</p></li>
</ol>

<p><strong>Notes:</strong></p>

<ul>
<li><p><strong>For vSphere</strong>, it is also possible to connect to your windows cell using the vCenter console once the Administrator password has been set.</p></li>
<li><p><strong>If the Windows is not accessible from your host</strong>, tunnel through the Ops Manager VM. To do this, SSH into the Ops Manager VM with the flag <code>-L 3389:&lt;Windows Cell IP&gt;:3389</code>
and then use IP 127.0.0.1 from your RDP client.</p></li>
</ul>

<h3 id="-consul-cli"><a id='consul'></a> Consul CLI</h3>

<p>Perform the following steps to use the Consul CLI on your Windows cell to diagnose problems with your Consul cluster:</p>

<ol>
<li>In your RDP session, open a PowerShell window.</li>
<li>Change into the directory that contains the Consul CLI binary:
<pre class="terminal">
PS C:\Users\Administrator&gt; cd C:\var\vcap\packages\consul-windows\bin\
</pre></li>
<li>Use the Consul CLI to list the members of your Consul cluster:
<pre class="terminal">
PS C:\Users\Administrator\var\vcap\packages\consul-windows\bin&gt; .\consul.exe members
Node                       Address          Status  Type    Build  Protocol  DC
cell-windows-0             10.0.0.111:8301  alive   client  0.6.4  2         dc1
cloud-controller-0         10.0.0.94:8301   alive   client  0.6.4  2         dc1
cloud-controller-worker-0  10.0.0.99:8301   alive   client  0.6.4  2         dc1
consul-server-0            10.0.0.96:8301   alive   server  0.6.4  2         dc1
diego-brain-0              10.0.0.109:8301  alive   client  0.6.4  2         dc1
diego-cell-0               10.0.0.103:8301  alive   client  0.6.4  2         dc1
diego-cell-1               10.0.0.104:8301  alive   client  0.6.4  2         dc1
diego-cell-2               10.0.0.107:8301  alive   client  0.6.4  2         dc1
diego-database-0           10.0.0.92:8301   alive   client  0.6.4  2         dc1
ha-proxy-0                 10.0.0.254:8301  alive   client  0.6.4  2         dc1
nfs-server-0               10.0.0.100:8301  alive   client  0.6.4  2         dc1
router-0                   10.0.0.105:8301  alive   client  0.6.4  2         dc1
uaa-0                      10.0.0.93:8301   alive   client  0.6.4  2         dc1
</pre></li>
<li>Examine the output to ensure that the <code>cell-windows-0</code> service is registered in the Consul cluster and is <code>alive</code>. Otherwise, your Windows cell cannot communicate with your PCF deployment and developers cannot push .NET apps to the Windows cell. Check the configuration of your Consul cluster, and ensure that your certificates are not missing or misconfigured.</li>
</ol>

        <div><a id='repo-link' href='http://github.com/pivotal-cf/docs-pcf-windows2012r2/tree/master/docs-content/windows-troubleshooting.html.md.erb'>Create a pull request or raise an issue on the source for this page in GitHub</a></div>

      </main>
    </div>
  </div>
</div>

<div id="scrim"></div>

<div class="container">
  <footer class="site-footer-links">
    <div class="copyright">
  <a href='https://pivotal.io/privacy-policy'>Privacy Policy</a> | 
  <a href='https://pivotal.io/terms-of-use'>Terms of Use</a><br/>
  <a href='/'>Pivotal Documentation</a>
  &copy; 2018 <a href='https://pivotal.io'>Pivotal Software</a>, Inc. All Rights Reserved.
</div>
<div class="support">
  Need help? <a href="http://support.pivotal.io" target="_blank">Visit Support</a>
</div>

  </footer>
</div><!--end of container-->

</body>
</html>
